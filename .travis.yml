language: node_js

compiler: gcc
sudo: false

os:
    - linux
    - osx
env:
    global:
      - secure: raWlTPsQx+QYCsrvrkG4uWp+4LnUWiMra1kxVN7Z2dVcv7nOkuB+7LBVBKOJo+u8i8WLMN7DgDuwuSmCRqHuZzgeT+hPNH4+jPNK1oY+v32YA01uS8WIdsBzeeThhxYfxlTbcXJ5j0KdDGZiS27IsRJJiL2A8+bRYmJTRDgXJCzjlZ3rUpjBnIS+f2+tXZ1oVKLbQoCyLUhiAfrRF/jifYVi22D+yaDlX/z9JiVpiWy8P+Hk8Df4TciILAe6To2i24IgK1bfujH93/ZMHl2IWIV4uQdLm6h6/szoS71uDgx/E8NccU6dmTr1437WrGg6/rPnE5dVI+Qp5KvUeXXVg5SIpk5B74vc02dVp25j3EGD68fETBp+0rxRPAYKAXfptDtFnpFuNOGFLaF2Zr4Y7eRe+cMfOvK3ZwoNxRuOa2cTF+TKytXEP7lKN+uFJc6qsobDB3XIgnNk362d/5AZNS3TPa6/THhPRKC4xhHHftNknra+lug42W8wIdOLXwUUh8fOBR99kKu05KysXJzu3vq+LcWY3vOTVWygKpwqsRs896OeFlY8bTWUIEJt93+evvhutrIuIbepJ+1ZMg97xcrOHLtQc3aJpuiikCj8saFQc+0/UohPtc30C3jY5/+bczT68nrQHf4NciAhmWCWpPFwYlXIqPUKWzSET7w2y5U=

node_js:
    - '7'
    - '8'
    - '9'
    - '10'
    - '11'
    - '12'

addons:
    apt:
        sources:
            - ubuntu-toolchain-r-test
        packages:
            - gcc-4.8
            - g++-4.8

before_install:
    - if [ "$TRAVIS_NODE_VERSION" = "0.8" ]; then npm install -g npm@2.7.3; fi;
    - if [ $TRAVIS_OS_NAME == "linux" ]; then
        export CC="gcc-4.8";
        export CXX="g++-4.8";
        export LINK="gcc-4.8";
        export LINKXX="g++-4.8";
        fi
    - nvm --version
    - node --version
    - npm --version
    - gcc --version
    - g++ --version

before_script:
    # figure out if we should publish
    - echo $TRAVIS_BRANCH
    - echo `git describe --tags --always HEAD`
    - PUBLISH_BINARY=false
    - COMMIT_MESSAGE=$(git show -s --format=%B $TRAVIS_COMMIT | tr -d '\n')
    - if [[ $TRAVIS_BRANCH == `git describe --tags --always HEAD` || ${COMMIT_MESSAGE} =~ "[publish binary]" ]]; then PUBLISH_BINARY=true; fi;
    - echo "Publishing binaries? ->" $PUBLISH_BINARY

install:
    - npm install --build-from-source

script:
    - npm test
    - if [[ $PUBLISH_BINARY == true ]]; then node-pre-gyp package && node-pre-gyp-github publish --release; fi;

#cache:
#  directories:
#    - $HOME/.node-gyp
#    - $HOME/.npm
#    - node_modules
